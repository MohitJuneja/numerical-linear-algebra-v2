---

title: 8. How to Implement Linear Regression


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/08-How-to-Implement-Linear-Regression.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/08-How-to-Implement-Linear-Regression.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the previous lesson, we calculated the least squares linear regression for a diabetes dataset, using scikit learn's implementation.  Today, we will look at how we could write our own implementation.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Getting-set-up">Getting set up<a class="anchor-link" href="#Getting-set-up"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">linear_model</span><span class="p">,</span> <span class="n">metrics</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">PolynomialFeatures</span>
<span class="kn">import</span> <span class="nn">math</span><span class="o">,</span> <span class="nn">scipy</span><span class="o">,</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">linalg</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">load_diabetes</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">feature_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;sex&#39;</span><span class="p">,</span> <span class="s1">&#39;bmi&#39;</span><span class="p">,</span> <span class="s1">&#39;bp&#39;</span><span class="p">,</span> <span class="s1">&#39;s1&#39;</span><span class="p">,</span> <span class="s1">&#39;s2&#39;</span><span class="p">,</span> <span class="s1">&#39;s3&#39;</span><span class="p">,</span> <span class="s1">&#39;s4&#39;</span><span class="p">,</span> <span class="s1">&#39;s5&#39;</span><span class="p">,</span> <span class="s1">&#39;s6&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">trn</span><span class="p">,</span><span class="n">test</span><span class="p">,</span><span class="n">y_trn</span><span class="p">,</span><span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">trn</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">test</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>((353, 10), (89, 10))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">regr_metrics</span><span class="p">(</span><span class="n">act</span><span class="p">,</span> <span class="n">pred</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">act</span><span class="p">,</span> <span class="n">pred</span><span class="p">)),</span> 
     <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">act</span><span class="p">,</span> <span class="n">pred</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="How-did-sklearn-do-it?">How did sklearn do it?<a class="anchor-link" href="#How-did-sklearn-do-it?"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>How is sklearn doing this?  By checking <a href="https://github.com/scikit-learn/scikit-learn/blob/14031f6/sklearn/linear_model/base.py#L417">the source code</a>, you can see that in the dense case, it calls <a href="https://github.com/scipy/scipy/blob/v0.19.0/scipy/linalg/basic.py#L892-L1058">scipy.linalg.lstqr</a>, which is calling a LAPACK method:</p>

<pre><code>    Options are ``'gelsd'``, ``'gelsy'``, ``'gelss'``. Default
    (``'gelsd'``) is a good choice.  However, ``'gelsy'`` can be slightly
    faster on many problems.  ``'gelss'`` was used historically.  It is
    generally slow but uses less memory.

</code></pre>
<ul>
<li><a href="https://software.intel.com/sites/products/documentation/doclib/mkl_sa/11/mkl_lapack_examples/_gelsd.htm">gelsd</a>: uses SVD and a divide-and-conquer method</li>
<li><a href="https://software.intel.com/en-us/node/521113">gelsy</a>: uses QR factorization</li>
<li><a href="https://software.intel.com/en-us/node/521114">gelss</a>: uses SVD</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Scipy-Sparse-Least-Squares">Scipy Sparse Least Squares<a class="anchor-link" href="#Scipy-Sparse-Least-Squares"> </a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We will not get into too much detail about the sparse version of least squares.  Here is a bit of info if you are interested:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://docs.scipy.org/doc/scipy-0.14.0/reference/generated/scipy.sparse.linalg.lsqr.html#id1">Scipy sparse lsqr</a> uses an iterative method called <a href="https://web.stanford.edu/class/cme324/paige-saunders2.pdf">Golub and Kahan bidiagonalization</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>from <a href="https://github.com/scipy/scipy/blob/v0.14.0/scipy/sparse/linalg/isolve/lsqr.py#L96">scipy sparse lsqr source code</a>:
  Preconditioning is another way to reduce the number of iterations. If it is possible to solve a related system <code>M*x = b</code> efficiently, where M approximates A in some helpful way (e.g. M - A has low rank or its elements are small relative to those of A), LSQR may converge more rapidly on the system <code>A*M(inverse)*z = b</code>, after which x can be recovered by solving M*x = z.</p>
<p>If A is symmetric, LSQR should not be used! Alternatives are the symmetric conjugate-gradient method (cg) and/or SYMMLQ.  SYMMLQ is an implementation of symmetric cg that applies to any symmetric A and will converge more rapidly than LSQR.  If A is positive definite, there are other implementations of symmetric cg that require slightly less work per iteration than SYMMLQ (but will take the same number of iterations).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="linalg.lstqr">linalg.lstqr<a class="anchor-link" href="#linalg.lstqr"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The sklearn implementation handled adding a constant term (since the y-intercept is presumably not 0 for the line we are learning) for us.  We will need to do that by hand now:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">trn_int</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">trn</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">trn</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
<span class="n">test_int</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">test</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Since <code>linalg.lstsq</code> lets us specify which LAPACK routine we want to use, lets try them all and do some timing comparisons:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> coef, _,_,_ = linalg.lstsq(trn_int, y_trn, lapack_driver=&quot;gelsd&quot;)
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>290 µs ± 9.24 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> coef, _,_,_ = linalg.lstsq(trn_int, y_trn, lapack_driver=&quot;gelsy&quot;)
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>140 µs ± 91.7 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> coef, _,_,_ = linalg.lstsq(trn_int, y_trn, lapack_driver=&quot;gelss&quot;)
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>199 µs ± 228 ns per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Naive-Solution">Naive Solution<a class="anchor-link" href="#Naive-Solution"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Recall that we want to find $\hat{x}$ that minimizes: 
{% raw %}
$$ \big\vert\big\vert Ax - b \big\vert\big\vert_2$$
{% endraw %}</p>
<p>Another way to think about this is that we are interested in where vector $b$ is closest to the subspace spanned by $A$ (called the <em>range of</em> $A$).  This is the projection of $b$ onto $A$.  Since $b - A\hat{x}$ must be perpendicular to the subspace spanned by $A$, we see that</p>
<p>{% raw %}
$$A^T (b - A\hat{x}) = 0 $$
{% endraw %}</p>
<p>(we are using $A^T$ because we want to multiply each column of $A$ by $b - A\hat{x}$</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This leads us to the <em>normal equations</em>:
{% raw %}
$$ x = (A^TA)^{-1}A^T b $$
{% endraw %}</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">ls_naive</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
     <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">A</span><span class="p">)</span> <span class="o">@</span> <span class="n">A</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">b</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> coeffs_naive = ls_naive(trn_int, y_trn)
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>45.8 µs ± 4.65 µs per loop (mean ± std. dev. of 7 runs, 10000 loops each)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">coeffs_naive</span> <span class="o">=</span> <span class="n">ls_naive</span><span class="p">(</span><span class="n">trn_int</span><span class="p">,</span> <span class="n">y_trn</span><span class="p">)</span>
<span class="n">regr_metrics</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">test_int</span> <span class="o">@</span> <span class="n">coeffs_naive</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(57.94102134545707, 48.053565198516438)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Normal-Equations-(Cholesky)">Normal Equations (Cholesky)<a class="anchor-link" href="#Normal-Equations-(Cholesky)"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Normal equations:
{% raw %}
$$ A^TA x = A^T b $$
{% endraw %}</p>
<p>If $A$ has full rank, the pseudo-inverse $(A^TA)^{-1}A^T$ is a <strong>square, hermitian positive definite</strong> matrix.  The standard way of solving such a system is <em>Cholesky Factorization</em>, which finds upper-triangular R s.t. $A^TA = R^TR$.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The following steps are based on Algorithm 11.1 from Trefethen:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">trn_int</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">y_trn</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">AtA</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">A</span>
<span class="n">Atb</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">b</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Warning:</strong> Numpy and Scipy default to different upper/lower for Cholesky</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">R</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cholesky</span><span class="p">(</span><span class="n">AtA</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">R</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[  0.9124,   0.1438,   0.1511,   0.3002,   0.2228,   0.188 ,
         -0.051 ,   0.1746,   0.22  ,   0.2768,  -0.2583],
       [  0.    ,   0.8832,   0.0507,   0.1826,  -0.0251,   0.0928,
         -0.3842,   0.2999,   0.0911,   0.15  ,   0.4393],
       [  0.    ,   0.    ,   0.8672,   0.2845,   0.2096,   0.2153,
         -0.2695,   0.3181,   0.3387,   0.2894,  -0.005 ],
       [  0.    ,   0.    ,   0.    ,   0.7678,   0.0762,  -0.0077,
          0.0383,   0.0014,   0.165 ,   0.166 ,   0.0234],
       [  0.    ,   0.    ,   0.    ,   0.    ,   0.8288,   0.7381,
          0.1145,   0.4067,   0.3494,   0.158 ,  -0.2826],
       [  0.    ,   0.    ,   0.    ,   0.    ,   0.    ,   0.3735,
         -0.3891,   0.2492,  -0.3245,  -0.0323,  -0.1137],
       [  0.    ,   0.    ,   0.    ,   0.    ,   0.    ,   0.    ,
          0.6406,  -0.511 ,  -0.5234,  -0.172 ,  -0.9392],
       [  0.    ,   0.    ,   0.    ,   0.    ,   0.    ,   0.    ,
          0.    ,   0.2887,  -0.0267,  -0.0062,   0.0643],
       [  0.    ,   0.    ,   0.    ,   0.    ,   0.    ,   0.    ,
          0.    ,   0.    ,   0.2823,   0.0636,   0.9355],
       [  0.    ,   0.    ,   0.    ,   0.    ,   0.    ,   0.    ,
          0.    ,   0.    ,   0.    ,   0.7238,   0.0202],
       [  0.    ,   0.    ,   0.    ,   0.    ,   0.    ,   0.    ,
          0.    ,   0.    ,   0.    ,   0.    ,  18.7319]])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>check our factorization:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">AtA</span> <span class="o">-</span> <span class="n">R</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">R</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>4.5140158187158533e-16</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% raw %}
$$ A^T A x = A^T b $$
{% endraw %}
{% raw %}
$$ R^T R x = A^T b $$
{% endraw %}
{% raw %}
$$ R^T w = A^T b $$
{% endraw %}
{% raw %}
$$ R x = w $$
{% endraw %}</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">w</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve_triangular</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">Atb</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">trans</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It's always good to check that our result is what we expect it to be: (in case we entered the wrong params, the function didn't return what we thought, or sometimes the docs are even outdated)</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">w</span> <span class="o">-</span> <span class="n">Atb</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>1.1368683772161603e-13</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">coeffs_chol</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve_triangular</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">R</span> <span class="o">@</span> <span class="n">coeffs_chol</span> <span class="o">-</span> <span class="n">w</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>6.861429794408013e-14</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">ls_chol</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cholesky</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">A</span><span class="p">)</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve_triangular</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">b</span><span class="p">,</span> <span class="n">trans</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve_triangular</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> coeffs_chol = ls_chol(trn_int, y_trn)
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>111 µs ± 272 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">coeffs_chol</span> <span class="o">=</span> <span class="n">ls_chol</span><span class="p">(</span><span class="n">trn_int</span><span class="p">,</span> <span class="n">y_trn</span><span class="p">)</span>
<span class="n">regr_metrics</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">test_int</span> <span class="o">@</span> <span class="n">coeffs_chol</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(57.9410213454571, 48.053565198516438)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="QR-Factorization">QR Factorization<a class="anchor-link" href="#QR-Factorization"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% raw %}
$$ A x = b $$
{% endraw %}
{% raw %}
$$ A = Q R $$
{% endraw %}
{% raw %}
$$ Q R x = b $$
{% endraw %}</p>
<p>{% raw %}
$$ R x = Q^T b $$
{% endraw %}</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">ls_qr</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="n">Q</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">qr</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;economic&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve_triangular</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">Q</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">b</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> coeffs_qr = ls_qr(trn_int, y_trn)
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>205 µs ± 264 ns per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">coeffs_qr</span> <span class="o">=</span> <span class="n">ls_qr</span><span class="p">(</span><span class="n">trn_int</span><span class="p">,</span> <span class="n">y_trn</span><span class="p">)</span>
<span class="n">regr_metrics</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">test_int</span> <span class="o">@</span> <span class="n">coeffs_qr</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(57.94102134545711, 48.053565198516452)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="SVD">SVD<a class="anchor-link" href="#SVD"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% raw %}
$$ A x = b $$
{% endraw %}</p>
<p>{% raw %}
$$ A = U \Sigma V $$
{% endraw %}</p>
<p>{% raw %}
$$ \Sigma V x = U^T b $$
{% endraw %}</p>
<p>{% raw %}
$$ \Sigma w = U^T b $$
{% endraw %}</p>
<p>{% raw %}
$$ x = V^T w $$
{% endraw %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>SVD gives the pseudo-inverse</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">ls_svd</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">U</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">Vh</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">full_matrices</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">w</span> <span class="o">=</span> <span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">b</span><span class="p">)</span><span class="o">/</span> <span class="n">sigma</span>
    <span class="k">return</span> <span class="n">Vh</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">w</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> coeffs_svd = ls_svd(trn_int, y_trn)
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>1.11 ms ± 320 ns per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> coeffs_svd = ls_svd(trn_int, y_trn)
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>266 µs ± 8.49 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">coeffs_svd</span> <span class="o">=</span> <span class="n">ls_svd</span><span class="p">(</span><span class="n">trn_int</span><span class="p">,</span> <span class="n">y_trn</span><span class="p">)</span>
<span class="n">regr_metrics</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">test_int</span> <span class="o">@</span> <span class="n">coeffs_svd</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(57.941021345457244, 48.053565198516687)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Random-Sketching-Technique-for-Least-Squares-Regression">Random Sketching Technique for Least Squares Regression<a class="anchor-link" href="#Random-Sketching-Technique-for-Least-Squares-Regression"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="http://researcher.watson.ibm.com/researcher/files/us-dpwoodru/journal.pdf">Linear Sketching</a> (Woodruff)</p>
<ol>
<li>Sample a r x n random matrix S, r &lt;&lt; n</li>
<li>Compute S A and S b</li>
<li>Find exact solution x to regression SA x = Sb</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Timing-Comparison">Timing Comparison<a class="anchor-link" href="#Timing-Comparison"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">timeit</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">scipylstq</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">b</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">row_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Normal Eqns- Naive&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Normal Eqns- Cholesky&#39;</span><span class="p">,</span> 
             <span class="s1">&#39;QR Factorization&#39;</span><span class="p">,</span> 
             <span class="s1">&#39;SVD&#39;</span><span class="p">,</span> 
             <span class="s1">&#39;Scipy lstsq&#39;</span><span class="p">]</span>

<span class="n">name2func</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Normal Eqns- Naive&#39;</span><span class="p">:</span> <span class="s1">&#39;ls_naive&#39;</span><span class="p">,</span> 
             <span class="s1">&#39;Normal Eqns- Cholesky&#39;</span><span class="p">:</span> <span class="s1">&#39;ls_chol&#39;</span><span class="p">,</span> 
             <span class="s1">&#39;QR Factorization&#39;</span><span class="p">:</span> <span class="s1">&#39;ls_qr&#39;</span><span class="p">,</span>
             <span class="s1">&#39;SVD&#39;</span><span class="p">:</span> <span class="s1">&#39;ls_svd&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Scipy lstsq&#39;</span><span class="p">:</span> <span class="s1">&#39;scipylstq&#39;</span><span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">])</span>
<span class="n">n_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_product</span><span class="p">([</span><span class="n">m_array</span><span class="p">,</span> <span class="n">n_array</span><span class="p">],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;# rows&#39;</span><span class="p">,</span> <span class="s1">&#39;# cols&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:,.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">row_names</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
<span class="n">df_error</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">row_names</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">m_array</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">n_array</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">m</span> <span class="o">&gt;=</span> <span class="n">n</span><span class="p">:</span>        
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span><span class="mi">40</span><span class="p">,[</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">])</span>   <span class="c1"># removed np.asfortranarray</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">m</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">row_names</span><span class="p">:</span>
                <span class="n">fcn</span> <span class="o">=</span> <span class="n">name2func</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="n">fcn</span> <span class="o">+</span> <span class="s1">&#39;(A,b)&#39;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="nb">globals</span><span class="p">())</span>
                <span class="n">df</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">),</span> <span class="n">t</span><span class="p">)</span>
                <span class="n">coeffs</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()[</span><span class="n">fcn</span><span class="p">](</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
                <span class="n">reg_met</span> <span class="o">=</span> <span class="n">regr_metrics</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">A</span> <span class="o">@</span> <span class="n">coeffs</span><span class="p">)</span>
                <span class="n">df_error</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">),</span> <span class="n">reg_met</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th># rows</th>
      <th colspan="3" halign="left">100</th>
      <th colspan="3" halign="left">1000</th>
      <th colspan="3" halign="left">10000</th>
    </tr>
    <tr>
      <th># cols</th>
      <th>20</th>
      <th>100</th>
      <th>1000</th>
      <th>20</th>
      <th>100</th>
      <th>1000</th>
      <th>20</th>
      <th>100</th>
      <th>1000</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Normal Eqns- Naive</th>
      <td>0.001276</td>
      <td>0.003634</td>
      <td>NaN</td>
      <td>0.000960</td>
      <td>0.005172</td>
      <td>0.293126</td>
      <td>0.002226</td>
      <td>0.021248</td>
      <td>1.164655</td>
    </tr>
    <tr>
      <th>Normal Eqns- Cholesky</th>
      <td>0.001660</td>
      <td>0.003958</td>
      <td>NaN</td>
      <td>0.001665</td>
      <td>0.004007</td>
      <td>0.093696</td>
      <td>0.001928</td>
      <td>0.010456</td>
      <td>0.399464</td>
    </tr>
    <tr>
      <th>QR Factorization</th>
      <td>0.002174</td>
      <td>0.006486</td>
      <td>NaN</td>
      <td>0.004235</td>
      <td>0.017773</td>
      <td>0.213232</td>
      <td>0.019229</td>
      <td>0.116122</td>
      <td>2.208129</td>
    </tr>
    <tr>
      <th>SVD</th>
      <td>0.003880</td>
      <td>0.021737</td>
      <td>NaN</td>
      <td>0.004672</td>
      <td>0.026950</td>
      <td>1.280490</td>
      <td>0.018138</td>
      <td>0.130652</td>
      <td>3.433003</td>
    </tr>
    <tr>
      <th>Scipy lstsq</th>
      <td>0.004338</td>
      <td>0.020198</td>
      <td>NaN</td>
      <td>0.004320</td>
      <td>0.021199</td>
      <td>1.083804</td>
      <td>0.012200</td>
      <td>0.088467</td>
      <td>2.134780</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_error</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th># rows</th>
      <th colspan="3" halign="left">100</th>
      <th colspan="3" halign="left">1000</th>
      <th colspan="3" halign="left">10000</th>
    </tr>
    <tr>
      <th># cols</th>
      <th>20</th>
      <th>100</th>
      <th>1000</th>
      <th>20</th>
      <th>100</th>
      <th>1000</th>
      <th>20</th>
      <th>100</th>
      <th>1000</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Normal Eqns- Naive</th>
      <td>1.702742</td>
      <td>0.000000</td>
      <td>NaN</td>
      <td>1.970767</td>
      <td>1.904873</td>
      <td>0.000000</td>
      <td>1.978383</td>
      <td>1.980449</td>
      <td>1.884440</td>
    </tr>
    <tr>
      <th>Normal Eqns- Cholesky</th>
      <td>1.702742</td>
      <td>0.000000</td>
      <td>NaN</td>
      <td>1.970767</td>
      <td>1.904873</td>
      <td>0.000000</td>
      <td>1.978383</td>
      <td>1.980449</td>
      <td>1.884440</td>
    </tr>
    <tr>
      <th>QR Factorization</th>
      <td>1.702742</td>
      <td>0.000000</td>
      <td>NaN</td>
      <td>1.970767</td>
      <td>1.904873</td>
      <td>0.000000</td>
      <td>1.978383</td>
      <td>1.980449</td>
      <td>1.884440</td>
    </tr>
    <tr>
      <th>SVD</th>
      <td>1.702742</td>
      <td>0.000000</td>
      <td>NaN</td>
      <td>1.970767</td>
      <td>1.904873</td>
      <td>0.000000</td>
      <td>1.978383</td>
      <td>1.980449</td>
      <td>1.884440</td>
    </tr>
    <tr>
      <th>Scipy lstsq</th>
      <td>1.702742</td>
      <td>0.000000</td>
      <td>NaN</td>
      <td>1.970767</td>
      <td>1.904873</td>
      <td>0.000000</td>
      <td>1.978383</td>
      <td>1.980449</td>
      <td>1.884440</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">store</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">HDFStore</span><span class="p">(</span><span class="s1">&#39;least_squares_results.h5&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">store</span><span class="p">[</span><span class="s1">&#39;df&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>C:\Users\rache\Anaconda3\lib\site-packages\IPython\core\interactiveshell.py:2881: PerformanceWarning: 
your performance may suffer as PyTables will pickle object types that it cannot
map directly to c-types [inferred_type-&gt;floating,key-&gt;block0_values] [items-&gt;[(100, 20), (100, 100), (100, 1000), (1000, 20), (1000, 100), (1000, 1000), (5000, 20), (5000, 100), (5000, 1000)]]

  exec(code_obj, self.user_global_ns, self.user_ns)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Notes">Notes<a class="anchor-link" href="#Notes"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I used the magick %prun to profile my code.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Alternative: least absolute deviation (L1 regression)</p>
<ul>
<li>Less sensitive to outliers than least squares.</li>
<li>No closed form solution, but can solve with linear programming</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Conditioning-&amp;-stability">Conditioning &amp; stability<a class="anchor-link" href="#Conditioning-&amp;-stability"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Condition-Number">Condition Number<a class="anchor-link" href="#Condition-Number"> </a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>Condition number</em> is a measure of how small changes to the input cause the output to change.</p>
<p><strong>Question</strong>: Why do we care about behavior with small changes to the input in numerical linear algebra?</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <em>relative condition number</em> is defined by</p>
<p>{% raw %}
$$ \kappa = \sup_{\delta x} \frac{\|\delta f\|}{\| f(x) \|}\bigg/ \frac{\| \delta x \|}{\| x \|} $$
{% endraw %}</p>
<p>where $\delta x$ is infinitesimal</p>
<p>According to Trefethen (pg. 91), a problem is <em>well-conditioned</em> if $\kappa$ is small (e.g. $1$, $10$, $10^2$) and <em>ill-conditioned</em> if $\kappa$ is large (e.g. $10^6$, $10^{16}$)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Conditioning</strong>: perturbation behavior of a mathematical problem (e.g. least squares)</p>
<p><strong>Stability</strong>: perturbation behavior of an algorithm used to solve that problem on a computer (e.g. least squares algorithms, householder, back substitution, gaussian elimination)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Conditioning-example">Conditioning example<a class="anchor-link" href="#Conditioning-example"> </a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The problem of computing eigenvalues of a non-symmetric matrix is often ill-conditioned</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
<span class="n">B</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">wA</span><span class="p">,</span> <span class="n">vrA</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="n">wB</span><span class="p">,</span> <span class="n">vrB</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">wA</span><span class="p">,</span> <span class="n">wB</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(array([ 1.+0.j,  1.+0.j]),
 array([  2.00000000e+00+0.j,  -2.22044605e-16+0.j]))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Condition-Number-of-a-Matrix">Condition Number of a Matrix<a class="anchor-link" href="#Condition-Number-of-a-Matrix"> </a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The product $\| A\| \|A^{-1} \|$ comes up so often it has its own name: the <em>condition number</em> of $A$.  Note that normally we talk about the conditioning of problems, not matrices.</p>
<p>The <em>condition number</em> of $A$ relates to:</p>
<ul>
<li>computing $b$ given $A$ and $x$ in $Ax = b$</li>
<li>computing $x$ given $A$ and $b$ in $Ax = b$</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Loose-ends">Loose ends<a class="anchor-link" href="#Loose-ends"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Full-vs-Reduced-Factorizations">Full vs Reduced Factorizations<a class="anchor-link" href="#Full-vs-Reduced-Factorizations"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>SVD</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Diagrams from Trefethen:</p>
<p>{% include image.html alt="" style="width: 80%" file="/numerical_linear_algebra/images/full_svd.JPG" %}</p>
<p>{% include image.html alt="" style="width: 70%" file="/numerical_linear_algebra/images/reduced_svd.JPG" %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>QR Factorization exists for ALL matrices</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Just like with SVD, there are full and reduced versions of the QR factorization.</p>
<p>{% include image.html alt="" style="width: 70%" file="/numerical_linear_algebra/images/full_qr.JPG" %}</p>
<p>{% include image.html alt="" style="width: 70%" file="/numerical_linear_algebra/images/reduced_qr.JPG" %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Matrix-Inversion-is-Unstable">Matrix Inversion is Unstable<a class="anchor-link" href="#Matrix-Inversion-is-Unstable"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.linalg</span> <span class="kn">import</span> <span class="n">hilbert</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">hilbert</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[ 1.    ,  0.5   ,  0.3333,  0.25  ,  0.2   ],
       [ 0.5   ,  0.3333,  0.25  ,  0.2   ,  0.1667],
       [ 0.3333,  0.25  ,  0.2   ,  0.1667,  0.1429],
       [ 0.25  ,  0.2   ,  0.1667,  0.1429,  0.125 ],
       [ 0.2   ,  0.1667,  0.1429,  0.125 ,  0.1111]])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">14</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">hilbert</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">A</span> <span class="o">@</span> <span class="n">x</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">A_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">A</span> <span class="o">@</span> <span class="n">A_inv</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>5.0516495470543212</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>2.2271635826494112e+17</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">A</span> <span class="o">@</span> <span class="n">A_inv</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[ 1.    ,  0.    , -0.0001,  0.0005, -0.0006,  0.0105, -0.0243,
         0.1862, -0.6351,  2.2005, -0.8729,  0.8925, -0.0032, -0.0106],
       [ 0.    ,  1.    , -0.    ,  0.    ,  0.0035,  0.0097, -0.0408,
         0.0773, -0.0524,  1.6926, -0.7776, -0.111 , -0.0403, -0.0184],
       [ 0.    ,  0.    ,  1.    ,  0.0002,  0.0017,  0.0127, -0.0273,
         0.    ,  0.    ,  1.4688, -0.5312,  0.2812,  0.0117,  0.0264],
       [ 0.    ,  0.    , -0.    ,  1.0005,  0.0013,  0.0098, -0.0225,
         0.1555, -0.0168,  1.1571, -0.9656, -0.0391,  0.018 , -0.0259],
       [-0.    ,  0.    , -0.    ,  0.0007,  1.0001,  0.0154,  0.011 ,
        -0.2319,  0.5651, -0.2017,  0.2933, -0.6565,  0.2835, -0.0482],
       [ 0.    , -0.    ,  0.    , -0.0004,  0.0059,  0.9945, -0.0078,
        -0.0018, -0.0066,  1.1839, -0.9919,  0.2144, -0.1866,  0.0187],
       [-0.    ,  0.    , -0.    ,  0.0009, -0.002 ,  0.0266,  0.974 ,
        -0.146 ,  0.1883, -0.2966,  0.4267, -0.8857,  0.2265, -0.0453],
       [ 0.    ,  0.    , -0.    ,  0.0002,  0.0009,  0.0197, -0.0435,
         1.1372, -0.0692,  0.7691, -1.233 ,  0.1159, -0.1766, -0.0033],
       [ 0.    ,  0.    , -0.    ,  0.0002,  0.    , -0.0018, -0.0136,
         0.1332,  0.945 ,  0.3652, -0.2478, -0.1682,  0.0756, -0.0212],
       [ 0.    , -0.    , -0.    ,  0.0003,  0.0038, -0.0007,  0.0318,
        -0.0738,  0.2245,  1.2023, -0.2623, -0.2783,  0.0486, -0.0093],
       [-0.    ,  0.    , -0.    ,  0.0004, -0.0006,  0.013 , -0.0415,
         0.0292, -0.0371,  0.169 ,  1.0715, -0.09  ,  0.1668, -0.0197],
       [ 0.    , -0.    ,  0.    ,  0.    ,  0.0016,  0.0062, -0.0504,
         0.1476, -0.2341,  0.8454, -0.7907,  1.4812, -0.15  ,  0.0186],
       [ 0.    , -0.    ,  0.    , -0.0001,  0.0022,  0.0034, -0.0296,
         0.0944, -0.1833,  0.6901, -0.6526,  0.2556,  0.8563,  0.0128],
       [ 0.    ,  0.    ,  0.    , -0.0001,  0.0018, -0.0041, -0.0057,
        -0.0374, -0.165 ,  0.3968, -0.2264, -0.1538, -0.0076,  1.005 ]])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">row_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Normal Eqns- Naive&#39;</span><span class="p">,</span>
             <span class="s1">&#39;QR Factorization&#39;</span><span class="p">,</span> 
             <span class="s1">&#39;SVD&#39;</span><span class="p">,</span> 
             <span class="s1">&#39;Scipy lstsq&#39;</span><span class="p">]</span>

<span class="n">name2func</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Normal Eqns- Naive&#39;</span><span class="p">:</span> <span class="s1">&#39;ls_naive&#39;</span><span class="p">,</span> 
             <span class="s1">&#39;QR Factorization&#39;</span><span class="p">:</span> <span class="s1">&#39;ls_qr&#39;</span><span class="p">,</span>
             <span class="s1">&#39;SVD&#39;</span><span class="p">:</span> <span class="s1">&#39;ls_svd&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Scipy lstsq&#39;</span><span class="p">:</span> <span class="s1">&#39;scipylstq&#39;</span><span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:,.9f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">row_names</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">row_names</span><span class="p">:</span>
    <span class="n">fcn</span> <span class="o">=</span> <span class="n">name2func</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="n">fcn</span> <span class="o">+</span> <span class="s1">&#39;(A,b)&#39;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="nb">globals</span><span class="p">())</span>
    <span class="n">coeffs</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()[</span><span class="n">fcn</span><span class="p">](</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="n">regr_metrics</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">A</span> <span class="o">@</span> <span class="n">coeffs</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="SVD-is-best-here!">SVD is best here!<a class="anchor-link" href="#SVD-is-best-here!"> </a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>DO NOT RERUN</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Time</th>
      <th>Error</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Normal Eqns- Naive</th>
      <td>0.001334339</td>
      <td>3.598901966</td>
    </tr>
    <tr>
      <th>QR Factorization</th>
      <td>0.002166139</td>
      <td>0.000000000</td>
    </tr>
    <tr>
      <th>SVD</th>
      <td>0.001556937</td>
      <td>0.000000000</td>
    </tr>
    <tr>
      <th>Scipy lstsq</th>
      <td>0.001871590</td>
      <td>0.000000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Another reason not to take inverse</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Even if $A$ is incredibly sparse, $A^{-1}$ is generally dense.  For large matrices, $A^{-1}$ could be so dense as to not fit in memory.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Runtime">Runtime<a class="anchor-link" href="#Runtime"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Matrix Inversion: $2n^3$</p>
<p>Matrix Multiplication: $n^3$</p>
<p>Cholesky: $\frac{1}{3}n^3$</p>
<p>QR, Gram Schmidt: $2mn^2$, $m\geq n$ (chapter 8 of Trefethen)</p>
<p>QR, Householder: $2mn^2 - \frac{2}{3}n^3$ (chapter 10 of Trefethen)</p>
<p>Solving a triangular system: $n^2$</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Why Cholesky Factorization is Fast:</strong></p>
<p>{% include image.html alt="" style="width: 100%" file="/numerical_linear_algebra/images/cholesky_factorization_speed.png" %}
(source: <a href="http://stanford.edu/class/ee364a/lectures/num-lin-alg.pdf">Stanford Convex Optimization: Numerical Linear Algebra Background Slides</a>)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="A-Case-Where-QR-is-the-Best">A Case Where QR is the Best<a class="anchor-link" href="#A-Case-Where-QR-is-the-Best"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="o">=</span><span class="mi">100</span>
<span class="n">n</span><span class="o">=</span><span class="mi">15</span>
<span class="n">t</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">A</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">t</span><span class="o">**</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)],</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">t</span><span class="p">))</span>

<span class="c1"># This will turn out to normalize the solution to be 1</span>
<span class="n">b</span> <span class="o">/=</span> <span class="mf">2006.787453080206</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&lt;matplotlib.lines.Line2D at 0x7fdfc1fa7eb8&gt;]</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Check that we get 1:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="mi">1</span> <span class="o">-</span> <span class="n">ls_qr</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">)[</span><span class="mi">14</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>1.4137685733217609e-07</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Bad condition number:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">kappa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">A</span><span class="p">);</span> <span class="n">kappa</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>5.827807196683593e+17</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">row_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Normal Eqns- Naive&#39;</span><span class="p">,</span>
             <span class="s1">&#39;QR Factorization&#39;</span><span class="p">,</span> 
             <span class="s1">&#39;SVD&#39;</span><span class="p">,</span> 
             <span class="s1">&#39;Scipy lstsq&#39;</span><span class="p">]</span>

<span class="n">name2func</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Normal Eqns- Naive&#39;</span><span class="p">:</span> <span class="s1">&#39;ls_naive&#39;</span><span class="p">,</span> 
             <span class="s1">&#39;QR Factorization&#39;</span><span class="p">:</span> <span class="s1">&#39;ls_qr&#39;</span><span class="p">,</span>
             <span class="s1">&#39;SVD&#39;</span><span class="p">:</span> <span class="s1">&#39;ls_svd&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Scipy lstsq&#39;</span><span class="p">:</span> <span class="s1">&#39;scipylstq&#39;</span><span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:,.9f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">row_names</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">row_names</span><span class="p">:</span>
    <span class="n">fcn</span> <span class="o">=</span> <span class="n">name2func</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="n">fcn</span> <span class="o">+</span> <span class="s1">&#39;(A,b)&#39;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="nb">globals</span><span class="p">())</span>
    <span class="n">coeffs</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()[</span><span class="n">fcn</span><span class="p">](</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">coeffs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Time</th>
      <th>Error</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Normal Eqns- Naive</th>
      <td>0.001565099</td>
      <td>1.357066025</td>
    </tr>
    <tr>
      <th>QR Factorization</th>
      <td>0.002632104</td>
      <td>0.000000116</td>
    </tr>
    <tr>
      <th>SVD</th>
      <td>0.003503785</td>
      <td>0.000000116</td>
    </tr>
    <tr>
      <th>Scipy lstsq</th>
      <td>0.002763502</td>
      <td>0.000000116</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The solution for least squares via the normal equations is unstable in general, although stable for problems with small condition numbers.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Low-rank">Low-rank<a class="anchor-link" href="#Low-rank"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<span class="n">A2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span> <span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span><span class="p">)])</span>   <span class="c1"># removed np.asfortranarray</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">A2</span><span class="p">,</span> <span class="n">A2</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">A2</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>((100, 10), (100, 5))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">A</span> <span class="o">@</span> <span class="n">x</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">m</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">row_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Normal Eqns- Naive&#39;</span><span class="p">,</span>
             <span class="s1">&#39;QR Factorization&#39;</span><span class="p">,</span> 
             <span class="s1">&#39;SVD&#39;</span><span class="p">,</span> 
             <span class="s1">&#39;Scipy lstsq&#39;</span><span class="p">]</span>

<span class="n">name2func</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Normal Eqns- Naive&#39;</span><span class="p">:</span> <span class="s1">&#39;ls_naive&#39;</span><span class="p">,</span> 
             <span class="s1">&#39;QR Factorization&#39;</span><span class="p">:</span> <span class="s1">&#39;ls_qr&#39;</span><span class="p">,</span>
             <span class="s1">&#39;SVD&#39;</span><span class="p">:</span> <span class="s1">&#39;ls_svd&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Scipy lstsq&#39;</span><span class="p">:</span> <span class="s1">&#39;scipylstq&#39;</span><span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:,.9f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">row_names</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">row_names</span><span class="p">:</span>
    <span class="n">fcn</span> <span class="o">=</span> <span class="n">name2func</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="n">fcn</span> <span class="o">+</span> <span class="s1">&#39;(A,b)&#39;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="nb">globals</span><span class="p">())</span>
    <span class="n">coeffs</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()[</span><span class="n">fcn</span><span class="p">](</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="n">regr_metrics</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">A</span> <span class="o">@</span> <span class="n">coeffs</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Time</th>
      <th>Error</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Normal Eqns- Naive</th>
      <td>0.001227640</td>
      <td>300.658979382</td>
    </tr>
    <tr>
      <th>QR Factorization</th>
      <td>0.002315920</td>
      <td>0.876019803</td>
    </tr>
    <tr>
      <th>SVD</th>
      <td>0.001745647</td>
      <td>1.584746056</td>
    </tr>
    <tr>
      <th>Scipy lstsq</th>
      <td>0.002067989</td>
      <td>0.804750398</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Comparison">Comparison<a class="anchor-link" href="#Comparison"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Our results from above:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th># rows</th>
      <th colspan="3" halign="left">100</th>
      <th colspan="3" halign="left">1000</th>
      <th colspan="3" halign="left">10000</th>
    </tr>
    <tr>
      <th># cols</th>
      <th>20</th>
      <th>100</th>
      <th>1000</th>
      <th>20</th>
      <th>100</th>
      <th>1000</th>
      <th>20</th>
      <th>100</th>
      <th>1000</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Normal Eqns- Naive</th>
      <td>0.001276</td>
      <td>0.003634</td>
      <td>NaN</td>
      <td>0.000960</td>
      <td>0.005172</td>
      <td>0.293126</td>
      <td>0.002226</td>
      <td>0.021248</td>
      <td>1.164655</td>
    </tr>
    <tr>
      <th>Normal Eqns- Cholesky</th>
      <td>0.001660</td>
      <td>0.003958</td>
      <td>NaN</td>
      <td>0.001665</td>
      <td>0.004007</td>
      <td>0.093696</td>
      <td>0.001928</td>
      <td>0.010456</td>
      <td>0.399464</td>
    </tr>
    <tr>
      <th>QR Factorization</th>
      <td>0.002174</td>
      <td>0.006486</td>
      <td>NaN</td>
      <td>0.004235</td>
      <td>0.017773</td>
      <td>0.213232</td>
      <td>0.019229</td>
      <td>0.116122</td>
      <td>2.208129</td>
    </tr>
    <tr>
      <th>SVD</th>
      <td>0.003880</td>
      <td>0.021737</td>
      <td>NaN</td>
      <td>0.004672</td>
      <td>0.026950</td>
      <td>1.280490</td>
      <td>0.018138</td>
      <td>0.130652</td>
      <td>3.433003</td>
    </tr>
    <tr>
      <th>Scipy lstsq</th>
      <td>0.004338</td>
      <td>0.020198</td>
      <td>NaN</td>
      <td>0.004320</td>
      <td>0.021199</td>
      <td>1.083804</td>
      <td>0.012200</td>
      <td>0.088467</td>
      <td>2.134780</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>From Trefethen (page 84):</p>
<p>Normal equations/Cholesky is fastest when it works.  Cholesky can only be used on symmetric, positive definite matrices.  Also, normal equations/Cholesky is unstable for matrices with high condition numbers or with low-rank.</p>
<p>Linear regression via QR has been recommended by numerical analysts as the standard method for years.  It is natural, elegant, and good for "daily use".</p>

</div>
</div>
</div>
</div>
 

